<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FALAAI - Jornal Escolar Social</title>
<style>
  :root {
    --bg-color: #f9f9f9;
    --text-color: #222;
    --card-bg: #fff;
    --primary: #2a86ff;
    --secondary: #444;
  }

  [data-theme="dark"] {
    --bg-color: #121212;
    --text-color: #eee;
    --card-bg: #1e1e1e;
    --primary: #4a90e2;
    --secondary: #bbb;
  }

  * {
    margin: 0; padding: 0; box-sizing: border-box;
    transition: background-color 0.3s, color 0.3s;
  }

  body {
    background: var(--bg-color);
    color: var(--text-color);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  header {
    background: var(--primary);
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 {
    font-weight: 700;
    font-size: 1.8rem;
    user-select: none;
  }

  main {
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* Navegação inferior (tipo Insta) */
  nav.bottom-nav {
    display: flex;
    justify-content: space-around;
    background: var(--card-bg);
    box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    padding: 0.8rem 0;
    position: fixed;
    bottom: 0;
    width: 100%;
    z-index: 10;
  }
  nav.bottom-nav button {
    background: none;
    border: none;
    color: var(--secondary);
    font-size: 0.9rem;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  nav.bottom-nav button.active {
    color: var(--primary);
    font-weight: 700;
  }

  /* Conteúdo das seções */
  section.page {
    flex: 1;
    padding: 1rem 1.5rem 5rem; /* bottom para não ficar escondido atrás do nav */
    display: none;
    overflow-y: auto;
  }
  section.page.active {
    display: block;
  }

  /* Feed (postagens) */
  #feed .post {
    background: var(--card-bg);
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  #feed .post h3 {
    margin-bottom: 0.3rem;
    font-weight: 700;
  }
  #feed .post p {
    margin-bottom: 0.6rem;
  }
  #feed .post .like-btn {
    cursor: pointer;
    color: var(--secondary);
    font-weight: 600;
    user-select: none;
  }
  #feed .post .like-btn.liked {
    color: var(--primary);
  }

  /* Perfil */
  #perfil {
    max-width: 500px;
    margin: 0 auto;
  }
  #perfil img.avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    display: block;
    margin: 0 auto 1rem;
  }
  #perfil input[type="file"] {
    display: none;
  }
  #perfil label.avatar-label {
    background: var(--primary);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    text-align: center;
    display: inline-block;
    cursor: pointer;
    margin-bottom: 1rem;
    user-select: none;
  }
  #perfil h2 {
    text-align: center;
    margin-bottom: 1rem;
  }
  #perfil textarea.bio {
    width: 100%;
    min-height: 80px;
    padding: 0.8rem;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #ccc;
    resize: vertical;
    margin-bottom: 1rem;
  }
  #perfil .save-msg {
    text-align: center;
    color: var(--primary);
    font-weight: 700;
    display: none;
  }

  /* Login */
  #login-form {
    max-width: 320px;
    margin: 3rem auto;
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  #login-form h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    font-weight: 700;
  }
  #login-form label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  #login-form input[type="text"],
  #login-form input[type="password"] {
    width: 100%;
    padding: 0.7rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
  #login-form button {
    width: 100%;
    padding: 0.8rem;
    background: var(--primary);
    color: white;
    font-weight: 700;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
  }
  #login-error {
    color: #d33;
    font-weight: 700;
    text-align: center;
    margin-bottom: 1rem;
    display: none;
  }

  /* Chat (DM) */
  #dm .chat-box {
    max-height: 400px;
    overflow-y: auto;
    background: var(--card-bg);
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-bottom: 1rem;
  }
  #dm .chat-message {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    max-width: 75%;
    margin-bottom: 0.4rem;
    word-wrap: break-word;
    user-select: text;
  }
  #dm .chat-message.sent {
    background: var(--primary);
    color: white;
    margin-left: auto;
  }
  #dm .chat-message.received {
    background: var(--secondary);
    color: white;
    margin-right: auto;
  }
  #dm .chat-input {
    display: flex;
    gap: 0.5rem;
  }
  #dm .chat-input input {
    flex: 1;
    padding: 0.7rem 1rem;
    font-size: 1rem;
    border-radius: 25px;
    border: 1px solid #ccc;
  }
  #dm .chat-input button {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 25px;
    padding: 0 1.2rem;
    cursor: pointer;
    font-weight: 700;
  }

  /* Tema toggle */
  .theme-toggle-btn {
    background: none;
    border: 2px solid white;
    color: white;
    border-radius: 25px;
    padding: 0.3rem 1rem;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
  }
  .theme-toggle-btn:hover {
    background: white;
    color: var(--primary);
  }

  /* Scrollbar personalizado */
  ::-webkit-scrollbar {
    width: 8px;
  }
  ::-webkit-scrollbar-thumb {
    background-color: var(--primary);
    border-radius: 10px;
  }
</style>
</head>
<body>

<header>
  <h1>FALAAI</h1>
  <button class="theme-toggle-btn" id="btnThemeToggle">Modo Escuro</button>
</header>

<main>
  <!-- Login -->
  <section id="login" class="page active">
    <form id="login-form">
      <h2>Entrar</h2>
      <div id="login-error">Usuário ou senha incorretos</div>
      <label for="username">Usuário</label>
      <input type="text" id="username" required autocomplete="off" />
      <label for="password">Senha</label>
      <input type="password" id="password" required autocomplete="off" />
      <button type="submit">Entrar</button>
    </form>
  </section>

  <!-- Feed de postagens -->
  <section id="feed" class="page">
    <button id="btnLogout" style="float:right;margin-bottom:1rem;color:#d33;background:none;border:none;cursor:pointer;font-weight:700;">Sair</button>
    <h2>Feed de Postagens</h2>

    <form id="postForm" style="margin-bottom:1rem;">
      <textarea id="postContent" rows="3" placeholder="Escreva uma nova postagem..." style="width:100%;padding:0.8rem;border-radius:10px;border:1px solid #ccc;"></textarea>
      <button type="submit" style="margin-top:0.5rem;padding:0.6rem 1rem;border:none;background:var(--primary);color:#fff;border-radius:10px;cursor:pointer;font-weight:700;">Postar</button>
    </form>

    <div id="postsContainer"></div>
  </section>

  <!-- Perfil do usuário -->
  <section id="perfil" class="page">
    <h2>Perfil</h2>
    <img src="https://i.pravatar.cc/100" alt="Avatar" class="avatar" id="avatarImg" />
    <label for="avatarInput" class="avatar-label">Alterar Avatar</label>
    <input type="file" id="avatarInput" accept="image/*" />
    <textarea id="bioInput" class="bio" placeholder="Escreva uma bio..."></textarea>
    <div class="save-msg" id="saveMsg">Salvo automaticamente!</div>
  </section>

  <!-- DM (Chat privado) -->
  <section id="dm" class="page">
    <h2>Chat</h2>
    <div class="chat-box" id="chatBox"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="Digite sua mensagem..." />
      <button id="sendChatBtn">Enviar</button>
    </div>
  </section>
</main>

<nav class="bottom-nav">
  <button data-page="feed">Feed</button>
  <button data-page="perfil">Perfil</button>
  <button data-page="dm">Chat</button>
</nav>

<script>
  // Controle de temas
  const btnThemeToggle = document.getElementById('btnThemeToggle');
  const rootEl = document.documentElement;

  // Salvar tema no localStorage
  function saveTheme(theme) {
    localStorage.setItem('theme', theme);
  }

  // Aplicar tema salvo ou padrão
  function applyTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    if(savedTheme === 'dark') {
      rootEl.setAttribute('data-theme', 'dark');
      btnThemeToggle.textContent = 'Modo Claro';
    } else {
      rootEl.removeAttribute('data-theme');
      btnThemeToggle.textContent = 'Modo Escuro';
    }
  }
  applyTheme();

  btnThemeToggle.addEventListener('click', () => {
    if(rootEl.getAttribute('data-theme') === 'dark') {
      rootEl.removeAttribute('data-theme');
      saveTheme('light');
      btnThemeToggle.textContent = 'Modo Escuro';
    } else {
      rootEl.setAttribute('data-theme', 'dark');
      saveTheme('dark');
      btnThemeToggle.textContent = 'Modo Claro';
    }
  });

  // Sistema de navegação simples
  const pages = document.querySelectorAll('section.page');
  const navButtons = document.querySelectorAll('nav.bottom-nav button');
  const loginPage = document.getElementById('login');
  let currentUser = null; // Objeto {username, isAdmin, avatar, bio, ...}

  function showPage(pageId) {
    pages.forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');

    navButtons.forEach(btn => btn.classList.remove('active'));
    if(pageId !== 'login') {
      const btn = [...navButtons].find(b => b.dataset.page === pageId);
      if(btn) btn.classList.add('active');
    }
  }

  navButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      if(!currentUser) return alert('Faça login primeiro!');
      showPage(btn.dataset.page);
    });
  });

  // LOGIN SIMPLES (sem backend)
  const loginForm = document.getElementById('login-form');
  const loginError = document.getElementById('login-error');

  // Usuários fixos (incluindo admin)
  const usersDB = [
    { username: 'saintex', password: 'ffg..1.', isAdmin: true, avatar: 'https://i.pravatar.cc/100?u=saintex', bio: 'Administrador do sistema' },
    // Você pode adicionar mais usuários aqui
  ];

  function loadUserData(username) {
    const dataKey = `userData_${username}`;
    const savedData = localStorage.getItem(dataKey);
    if(savedData) return JSON.parse(savedData);
    // Se não tiver salvo, pega dados básicos do usersDB
    const userInfo = usersDB.find(u => u.username === username);
    return { avatar: userInfo.avatar, bio: userInfo.bio || '', likedPosts: [], commentsHistory: [], chatHistory: [] };
  }

  function saveUserData(username, data) {
    localStorage.setItem(`userData_${username}`, JSON.stringify(data));
  }

  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = loginForm.username.value.trim();
    const password = loginForm.password.value;

    const user = usersDB.find(u => u.username === username && u.password === password);
    if(!user) {
      loginError.style.display = 'block';
      return;
    }
    loginError.style.display = 'none';
    currentUser = { username: user.username, isAdmin: user.isAdmin };
    currentUser.data = loadUserData(currentUser.username);
    setupAfterLogin();
    showPage('feed');
  });

  // Após login, inicializa funcionalidades
  function setupAfterLogin() {
    // Exibe nome do usuário no header (pode customizar)
    document.querySelector('header h1').textContent = `FALAAI - Olá, ${currentUser.username}${currentUser.isAdmin ? ' (Admin)' : ''}`;

    // Carrega perfil (avatar e bio)
    const avatarImg = document.getElementById('avatarImg');
    const bioInput = document.getElementById('bioInput');
    avatarImg.src = currentUser.data.avatar || 'https://i.pravatar.cc/100';
    bioInput.value = currentUser.data.bio || '';

    // Salva automaticamente bio ao digitar (debounce)
    let bioTimer;
    bioInput.addEventListener('input', () => {
      clearTimeout(bioTimer);
      bioTimer = setTimeout(() => {
        currentUser.data.bio = bioInput.value;
        saveUserData(currentUser.username, currentUser.data);
        showSaveMsg();
      }, 500);
    });

    // Avatar upload simples
    const avatarInput = document.getElementById('avatarInput');
    avatarInput.onchange = e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        avatarImg.src = reader.result;
        currentUser.data.avatar = reader.result;
        saveUserData(currentUser.username, currentUser.data);
        showSaveMsg();
      };
      reader.readAsDataURL(file);
    };

    // Postagens
    loadPosts();

    // Chat
    loadChat();
  }

  // Mensagem "Salvo"
  function showSaveMsg() {
    const msg = document.getElementById('saveMsg');
    msg.style.display = 'block';
    clearTimeout(msg._timer);
    msg._timer = setTimeout(() => {
      msg.style.display = 'none';
    }, 1500);
  }

  // LOGOUT
  const btnLogout = document.getElementById('btnLogout');
  btnLogout.addEventListener('click', () => {
    if(confirm('Deseja realmente sair?')) {
      currentUser = null;
      document.querySelector('header h1').textContent = 'FALAAI';
      showPage('login');
    }
  });

  // POSTAGENS (Feed)
  const postForm = document.getElementById('postForm');
  const postContent = document.getElementById('postContent');
  const postsContainer = document.getElementById('postsContainer');

  // Carrega posts do localStorage (global para todos usuários)
  function loadPosts() {
    const savedPosts = localStorage.getItem('globalPosts');
    const posts = savedPosts ? JSON.parse(savedPosts) : [];
    postsContainer.innerHTML = '';
    posts.forEach((post, idx) => {
      const div = document.createElement('div');
      div.className = 'post';

      // Texto da postagem
      const h3 = document.createElement('h3');
      h3.textContent = post.author + (post.author === currentUser.username ? ' (Você)' : '');
      div.appendChild(h3);

      const p = document.createElement('p');
      p.textContent = post.content;
      div.appendChild(p);

      // Curtir botão
      const likeBtn = document.createElement('span');
      likeBtn.className = 'like-btn';
      likeBtn.textContent = `❤️ ${post.likes.length}`;
      if(post.likes.includes(currentUser.username)) likeBtn.classList.add('liked');
      likeBtn.onclick = () => toggleLike(idx);
      div.appendChild(likeBtn);

      // Botão de apagar post (só admins ou autor)
      if(currentUser.isAdmin || post.author === currentUser.username) {
        const delBtn = document.createElement('button');
        delBtn.textContent = 'Apagar';
        delBtn.style.marginLeft = '1rem';
        delBtn.onclick = () => deletePost(idx);
        div.appendChild(delBtn);
      }

      postsContainer.appendChild(div);
    });
  }

  function savePosts(posts) {
    localStorage.setItem('globalPosts', JSON.stringify(posts));
  }

  // Criar nova postagem
  postForm.addEventListener('submit', e => {
    e.preventDefault();
    const content = postContent.value.trim();
    if(content === '') return alert('Digite algo para postar.');

    const savedPosts = localStorage.getItem('globalPosts');
    const posts = savedPosts ? JSON.parse(savedPosts) : [];

    posts.unshift({ author: currentUser.username, content, likes: [] });
    savePosts(posts);
    postContent.value = '';
    loadPosts();
  });

  // Curtir ou descurtir post
  function toggleLike(postIdx) {
    const savedPosts = localStorage.getItem('globalPosts');
    if(!savedPosts) return;
    const posts = JSON.parse(savedPosts);
    const post = posts[postIdx];
    if(post.likes.includes(currentUser.username)) {
      post.likes = post.likes.filter(u => u !== currentUser.username);
    } else {
      post.likes.push(currentUser.username);
    }
    savePosts(posts);
    loadPosts();
  }

  // Apagar post (só admins ou autor)
  function deletePost(postIdx) {
    if(!confirm('Tem certeza que deseja apagar esta postagem?')) return;
    const savedPosts = localStorage.getItem('globalPosts');
    if(!savedPosts) return;
    const posts = JSON.parse(savedPosts);
    const post = posts[postIdx];
    if(currentUser.isAdmin || post.author === currentUser.username) {
      posts.splice(postIdx, 1);
      savePosts(posts);
      loadPosts();
    } else {
      alert('Você não tem permissão para apagar esta postagem.');
    }
  }

  // CHAT (DM)
  const chatBox = document.getElementById('chatBox');
  const chatInput = document.getElementById('chatInput');
  const sendChatBtn = document.getElementById('sendChatBtn');

  // Carregar histórico do chat privado do usuário (localStorage)
  function loadChat() {
    const chatHistory = currentUser.data.chatHistory || [];
    chatBox.innerHTML = '';
    chatHistory.forEach(msg => {
      const div = document.createElement('div');
      div.textContent = `[${msg.time}] ${msg.sender}: ${msg.text}`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // Enviar mensagem no chat privado (armazena localmente)
  sendChatBtn.addEventListener('click', sendMessage);
  chatInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') sendMessage();
  });

  function sendMessage() {
    const text = chatInput.value.trim();
    if(text === '') return;
    const now = new Date();
    const time = now.toLocaleTimeString();

    // Mensagem enviada pelo usuário atual
    const msg = { sender: currentUser.username, text, time };
    currentUser.data.chatHistory = currentUser.data.chatHistory || [];
    currentUser.data.chatHistory.push(msg);
    saveUserData(currentUser.username, currentUser.data);

    const div = document.createElement('div');
    div.textContent = `[${time}] Você: ${text}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
    chatInput.value = '';
  }

  // Ao iniciar, mostra a tela de login
  showPage('login');
</script>
</body>
</html>
