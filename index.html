<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FalaAí Social - Rede Escolar</title>
<style>
  /* ===== VARIÁVEIS DE CORES ===== */
  :root {
    --primary: #1d9bf0;
    --primary-dark: #1578c8;
    --bg-light: #f5f8fa;
    --bg-dark: #15202b;
    --text-light: #14171a;
    --text-dark: #e1e8ed;
    --gray-light: #657786;
    --gray-dark: #8899a6;
    --white: #fff;
    --error: #e0245e;
  }

  /* ===== MODO DARK ===== */
  [data-theme="dark"] {
    --bg-light: var(--bg-dark);
    --text-light: var(--text-dark);
    --gray-light: var(--gray-dark);
    background: var(--bg-dark);
    color: var(--text-dark);
  }

  /* ===== RESET ===== */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    background: var(--bg-light);
    color: var(--text-light);
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* ===== SIDEBAR ===== */
  aside {
    width: 280px;
    background: var(--white);
    border-right: 1px solid #ccc;
    padding: 2rem 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  [data-theme="dark"] aside {
    background: #192734;
    border-color: #38444d;
  }

  aside img.avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 1rem;
    cursor: pointer;
  }

  aside input[type="file"] {
    display: none;
  }

  aside h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }

  aside button#toggleTheme {
    margin-top: auto;
    padding: 0.5rem 1rem;
    background: var(--primary);
    color: var(--white);
    border: none;
    border-radius: 9999px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }

  aside button#toggleTheme:hover {
    background: var(--primary-dark);
  }

  aside input#userName {
    margin-top: 1rem;
    padding: 0.5rem;
    width: 100%;
    border-radius: 9999px;
    border: 1px solid #ccc;
    text-align: center;
    font-size: 1rem;
  }

  [data-theme="dark"] aside input#userName {
    background: #22303c;
    color: var(--text-dark);
    border-color: #38444d;
  }

  /* ===== MAIN ===== */
  main {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-light);
  }

  /* ===== FEED ===== */
  #feed {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* ===== POST BOX ===== */
  #postBox {
    padding: 1rem 2rem;
    border-bottom: 1px solid #ccc;
    background: var(--white);
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  [data-theme="dark"] #postBox {
    background: #192734;
    border-color: #38444d;
  }

  #postBox textarea {
    flex: 1;
    resize: none;
    height: 70px;
    border-radius: 1rem;
    border: 1px solid #ccc;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    font-family: inherit;
  }

  [data-theme="dark"] #postBox textarea {
    background: #22303c;
    color: var(--text-dark);
    border-color: #38444d;
  }

  #postBox button {
    background: var(--primary);
    border: none;
    color: var(--white);
    font-weight: 700;
    padding: 0.75rem 1.5rem;
    border-radius: 9999px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  #postBox button:disabled {
    background: #9ac7fc;
    cursor: not-allowed;
  }

  #postBox button:hover:not(:disabled) {
    background: var(--primary-dark);
  }

  /* ===== POST ===== */
  .post {
    background: var(--white);
    border-radius: 1rem;
    padding: 1rem 1.5rem;
    display: flex;
    gap: 1rem;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
    transition: background-color 0.3s ease;
  }

  [data-theme="dark"] .post {
    background: #192734;
    box-shadow: none;
  }

  .post img.avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
  }

  .post-content {
    flex: 1;
  }

  .post-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.3rem;
  }

  .post-header strong {
    font-size: 1.1rem;
  }

  .post-header time {
    font-size: 0.85rem;
    color: var(--gray-light);
  }

  [data-theme="dark"] .post-header time {
    color: var(--gray-dark);
  }

  .post-text {
    white-space: pre-wrap;
    font-size: 1rem;
  }

  /* ===== SCROLLBAR CUSTOM ===== */
  #feed::-webkit-scrollbar {
    width: 8px;
  }
  #feed::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 4px;
  }
  #feed::-webkit-scrollbar-track {
    background: transparent;
  }

  /* ===== ALERT ===== */
  #alert {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    background: var(--error);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    font-weight: 700;
    box-shadow: 0 0 10px var(--error);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.4s ease;
  }

  #alert.show {
    opacity: 1;
    pointer-events: auto;
  }
</style>
</head>
<body>

<aside>
  <label for="avatarInput">
    <img src="https://placehold.co/120x120?text=Avatar" alt="Avatar" class="avatar" id="avatar" title="Clique para trocar foto" />
  </label>
  <input type="file" id="avatarInput" accept="image/*" />
  <input type="text" id="userName" placeholder="Seu nome aqui..." maxlength="20" />
  <button id="toggleTheme">Modo Escuro</button>
</aside>

<main>
  <section id="postBox">
    <textarea id="postText" placeholder="Escreva algo para o pessoal..." maxlength="280" rows="3"></textarea>
    <button id="btnPost" disabled>Publicar</button>
  </section>

  <section id="feed">
    <!-- Posts aparecem aqui -->
  </section>
</main>

<div id="alert"></div>

<script>
  // TROCA DE TEMA
  const btnTheme = document.getElementById('toggleTheme');
  const root = document.documentElement;
  btnTheme.onclick = () => {
    if(root.getAttribute('data-theme') === 'dark') {
      root.setAttribute('data-theme', 'light');
      btnTheme.textContent = 'Modo Escuro';
      localStorage.setItem('theme', 'light');
    } else {
      root.setAttribute('data-theme', 'dark');
      btnTheme.textContent = 'Modo Claro';
      localStorage.setItem('theme', 'dark');
    }
  };

  // SETAR TEMA SALVO
  if(localStorage.getItem('theme')) {
    const savedTheme = localStorage.getItem('theme');
    root.setAttribute('data-theme', savedTheme);
    btnTheme.textContent = savedTheme === 'dark' ? 'Modo Claro' : 'Modo Escuro';
  }

  // AVATAR
  const avatarInput = document.getElementById('avatarInput');
  const avatarImg = document.getElementById('avatar');
  avatarInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      avatarImg.src = e.target.result;
      localStorage.setItem('profilePic', e.target.result);
    };
    reader.readAsDataURL(file);
  });
  // carregar avatar salvo
  const savedAvatar = localStorage.getItem('profilePic');
  if(savedAvatar) avatarImg.src = savedAvatar;

  // NOME
  const userNameInput = document.getElementById('userName');
  userNameInput.value = localStorage.getItem('userName') || '';
  userNameInput.addEventListener('input', () => {
    localStorage.setItem('userName', userNameInput.value.trim());
    checarTexto();
  });

  // POSTAR
  const postText = document.getElementById('postText');
  const btnPost = document.getElementById('btnPost');
  const feed = document.getElementById('feed');

  function checarTexto() {
    const txt = postText.value.trim();
    const nome = userNameInput.value.trim();
    btnPost.disabled = (txt.length === 0 || nome.length === 0);
  }

  postText.addEventListener('input', checarTexto);

  btnPost.addEventListener('click', () => {
    const texto = postText.value.trim();
    const nome = userNameInput.value.trim();
    if(!nome) {
      mostrarAlerta('Digite seu nome antes de postar!');
      return;
    }
    if(!texto) {
      mostrarAlerta('Digite algo para postar!');
      return;
    }

    postar(texto, nome);
    postText.value = '';
    btnPost.disabled = true;
  });

  function postar(texto, nome) {
    const post = document.createElement('article');
    post.classList.add('post');

    // pegar avatar salvo ou placeholder
    const avatarSrc = localStorage.getItem('profilePic') || 'https://placehold.co/50x50';

    // hora atual formatada
    const agora = new Date();
    const horas = String(agora.getHours()).padStart(2, '0');
    const minutos = String(agora.getMinutes()).padStart(2, '0');
    const horaFormatada = `${horas}:${minutos}`;

    post.innerHTML = `
      <img src="${avatarSrc}" alt="Avatar" class="avatar" />
      <div class="post-content">
        <div class="post-header">
          <strong>@${nome}</strong>
          <time title="${agora.toLocaleString()}">${horaFormatada}</time>
        </div>
        <p class="post-text">${escapeHtml(texto)}</p>
      </div>
    `;

    feed.prepend(post);
    feed.scrollTop = 0;
  }

  // Escapa HTML para evitar injeção
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return {
        '&': "&amp;",
        '<': "&lt;",
        '>': "&gt;",
        '"': "&quot;",
        "'": "&#39;"
      }[m];
    });
  }

  // ALERTA SIMPLES
  const alertBox = document.getElementById('alert');
  function mostrarAlerta(msg) {
    alertBox.textContent = msg;
    alertBox.classList.add('show');
    setTimeout(() => alertBox.classList.remove('show'), 2500);
  }
</script>

</body>
</html>
